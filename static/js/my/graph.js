define(['d3', 'd3.chart'], function(d3, d3Chart){

	var 
		self = this,
		
		map,
		 
		locationLayer,
		 
		locdata =[	{"Key":"sensor1","DateTime":"2013-10-05T11:42:00","Lat":-33.697746,"Long":150.948976,"Heading":142.0,"Speed":3},
					{"Key":"sensor1","DateTime":"2013-10-05T11:42:11","Lat":-33.697904,"Long":150.949018,"Heading":150.0,"Speed":14},
					{"Key":"sensor1","DateTime":"2013-10-05T11:42:21","Lat":-33.697899,"Long":150.949596,"Heading":71.0,"Speed":31},
					{"Key":"sensor1","DateTime":"2013-10-05T11:42:34","Lat":-33.697633,"Long":150.950278,"Heading":60.0,"Speed":6},
					{"Key":"sensor1","DateTime":"2013-10-05T11:42:44","Lat":-33.698053,"Long":150.95093,"Heading":136.0,"Speed":42},
					{"Key":"sensor1","DateTime":"2013-10-05T11:42:54","Lat":-33.699021,"Long":150.951631,"Heading":172.0,"Speed":42},
					{"Key":"sensor1","DateTime":"2013-10-05T11:43:04","Lat":-33.699581,"Long":150.951561,"Heading":249.0,"Speed":31},
					{"Key":"sensor1","DateTime":"2013-10-05T11:43:14","Lat":-33.699943,"Long":150.950365,"Heading":254.0,"Speed":33},
					{"Key":"sensor1","DateTime":"2013-10-05T11:43:24","Lat":-33.699609,"Long":150.949634,"Heading":312.0,"Speed":44},
					{"Key":"sensor1","DateTime":"2013-10-05T11:43:34","Lat":-33.698913,"Long":150.948713,"Heading":314.0,"Speed":43},
					{"Key":"sensor1","DateTime":"2013-10-05T11:43:44","Lat":-33.697978,"Long":150.947943,"Heading":350.0,"Speed":50},
					{"Key":"sensor1","DateTime":"2013-10-05T11:43:54","Lat":-33.696968,"Long":150.947936,"Heading":295.0,"Speed":25},
					{"Key":"sensor1","DateTime":"2013-10-05T11:44:04","Lat":-33.697046,"Long":150.946673,"Heading":251.0,"Speed":46},
					{"Key":"sensor1","DateTime":"2013-10-05T11:44:14","Lat":-33.697473,"Long":150.945416,"Heading":250.0,"Speed":50},
					{"Key":"sensor1","DateTime":"2013-10-05T11:44:24","Lat":-33.697876,"Long":150.943949,"Heading":257.0,"Speed":54},
					{"Key":"sensor1","DateTime":"2013-10-05T11:44:34","Lat":-33.697866,"Long":150.942326,"Heading":277.0,"Speed":50},
					{"Key":"sensor1","DateTime":"2013-10-05T11:44:44","Lat":-33.697496,"Long":150.941381,"Heading":342.0,"Speed":37},
					{"Key":"sensor1","DateTime":"2013-10-05T11:44:54","Lat":-33.696556,"Long":150.941026,"Heading":341.0,"Speed":19},
					{"Key":"sensor1","DateTime":"2013-10-05T11:45:04","Lat":-33.696424,"Long":150.940913,"Heading":294.0,"Speed":16},
					{"Key":"sensor1","DateTime":"2013-10-05T11:45:14","Lat":-33.696531,"Long":150.939619,"Heading":261.0,"Speed":54},
					{"Key":"sensor1","DateTime":"2013-10-05T11:45:24","Lat":-33.696653,"Long":150.938214,"Heading":264.0,"Speed":29},
					{"Key":"sensor1","DateTime":"2013-10-05T11:45:34","Lat":-33.696744,"Long":150.937811,"Heading":283.0,"Speed":21},
					{"Key":"sensor1","DateTime":"2013-10-05T11:45:44","Lat":-33.695909,"Long":150.937266,"Heading":319.0,"Speed":49},
					{"Key":"sensor1","DateTime":"2013-10-05T11:45:54","Lat":-33.695131,"Long":150.935999,"Heading":294.0,"Speed":53},
					{"Key":"sensor1","DateTime":"2013-10-05T11:46:04","Lat":-33.694929,"Long":150.934709,"Heading":269.0,"Speed":49},
					{"Key":"sensor1","DateTime":"2013-10-05T11:46:14","Lat":-33.695546,"Long":150.933127,"Heading":229.0,"Speed":64},
					{"Key":"sensor1","DateTime":"2013-10-05T11:46:24","Lat":-33.696386,"Long":150.931827,"Heading":243.0,"Speed":29},
					{"Key":"sensor1","DateTime":"2013-10-05T11:46:34","Lat":-33.695751,"Long":150.931546,"Heading":359.0,"Speed":46},
					{"Key":"sensor1","DateTime":"2013-10-05T11:46:44","Lat":-33.694866,"Long":150.931501,"Heading":9.0,"Speed":36},
					{"Key":"sensor1","DateTime":"2013-10-05T11:46:54","Lat":-33.693836,"Long":150.931094,"Heading":327.0,"Speed":51},
					{"Key":"sensor1","DateTime":"2013-10-05T11:47:04","Lat":-33.692824,"Long":150.929959,"Heading":316.0,"Speed":56},
					{"Key":"sensor1","DateTime":"2013-10-05T11:47:14","Lat":-33.691719,"Long":150.929204,"Heading":346.0,"Speed":55},
					{"Key":"sensor1","DateTime":"2013-10-05T11:47:24","Lat":-33.690373,"Long":150.928637,"Heading":330.0,"Speed":51},
					{"Key":"sensor1","DateTime":"2013-10-05T11:47:51","Lat":-33.690083,"Long":150.928431,"Heading":329.0,"Speed":15},
					{"Key":"sensor1","DateTime":"2013-10-05T11:48:01","Lat":-33.689213,"Long":150.927736,"Heading":323.0,"Speed":50},
					{"Key":"sensor1","DateTime":"2013-10-05T11:48:11","Lat":-33.688236,"Long":150.926652,"Heading":311.0,"Speed":53},
					{"Key":"sensor1","DateTime":"2013-10-05T11:48:21","Lat":-33.688266,"Long":150.925791,"Heading":230.0,"Speed":43},
					{"Key":"sensor1","DateTime":"2013-10-05T11:48:32","Lat":-33.688799,"Long":150.924939,"Heading":231.0,"Speed":3},
					{"Key":"sensor1","DateTime":"2013-10-05T11:49:14","Lat":-33.688856,"Long":150.924861,"Heading":230.0,"Speed":22},
					{"Key":"sensor1","DateTime":"2013-10-05T11:49:24","Lat":-33.689453,"Long":150.924032,"Heading":215.0,"Speed":16},
					{"Key":"sensor1","DateTime":"2013-10-05T11:49:34","Lat":-33.689794,"Long":150.924321,"Heading":145.0,"Speed":4},
					{"Key":"sensor1","DateTime":"2013-10-05T11:49:44","Lat":-33.689846,"Long":150.924357,"Heading":147.0,"Speed":16},
					{"Key":"sensor1","DateTime":"2013-10-05T11:49:56","Lat":-33.690116,"Long":150.924631,"Heading":93.0,"Speed":5},
					{"Key":"sensor1","DateTime":"2013-10-05T11:50:06","Lat":-33.689966,"Long":150.924704,"Heading":87.0,"Speed":1},
					{"Key":"sensor1","DateTime":"2013-10-05T11:50:19","Lat":-33.689864,"Long":150.924732,"Heading":87.0,"Speed":1}],
	
		locindex = 0,
		
		GPSUser = function(initData) {
		   //state information
		   var _div = null;
		   var _data = initData;
		   var _projection = null;

		   function transform(d) {
			   var padding = 10;                   
			   d = new google.maps.LatLng(d.Lat, d.Long);
			   d = _projection.fromLatLngToDivPixel(d);
			   return d3.select(this) 
				   .style("left", (d.x - padding) + "px")
				   .style("top", (d.y - padding) + "px");
		   }
		   
		   function transformWithEase(d) {
			   var padding = 10;
			   d = new google.maps.LatLng(d.Lat, d.Long);
			   d = _projection.fromLatLngToDivPixel(d);
			   return d3.select(this)
				   .transition().duration(300)
				   .style("left", (d.x - padding) + "px")
				   .style("top", (d.y - padding) + "px");
		   }

		   //superclass methods for google maps
		   this.onAdd = function() {
			   _div = d3.select(this.getPanes().overlayLayer)
						.append("div")
						.attr("class", "stations");
		   };               
						  
		   this.draw = function () {                   
			   var padding = 10;
			   _projection = this.getProjection();

			   
			   var marker = _div.selectAll("svg")
				   .data(_data, function (d) { return d.Key; })
				   .each(transform) // update existing markers
					.enter().append("svg:svg")
				   .each(transform)
				   .attr("class", "marker");

			   // Add a circle.
			   marker.append("svg:circle") 
				   .attr("r", 4.5)
				   .attr("cx", padding)
				   .attr("cy", padding);

			   // Add a label.
			   marker.append("svg:text")
				   .attr("x", padding + 7)
				   .attr("y", padding)
				   .attr("dy", ".31em")
				   .text(function (d) { return d.Key; });                                      
		   };

		   this.onRemove = function () {
			   _div.remove();
		   };

		   this.update = function (data) {      
			   if (_div){ //_div may be null if map hasn't loaded..
			   	_div.selectAll("svg")
				   .data(data, function (d) { return d.Key; }) 
				   .each(transformWithEase);
				}                  
		   };
	   	},
		
		init = function(){
			
			//var body = d3.select("#graph");
			//var div = body.append("div");
			//div.html("Hello, world!");
			loadMap(new google.maps.LatLng(-33.690126, 150.924187));
			var speedData=[{"DateTime":"2013-10-05T11:42:50","Value":5},{"DateTime":"2013-10-05T11:42:57","Value":0},{"DateTime":"2013-10-05T11:42:59","Value":5},{"DateTime":"2013-10-05T11:43:03","Value":19},{"DateTime":"2013-10-05T11:43:13","Value":24},{"DateTime":"2013-10-05T11:43:23","Value":20},{"DateTime":"2013-10-05T11:43:32","Value":31},{"DateTime":"2013-10-05T11:43:41","Value":36},{"DateTime":"2013-10-05T11:43:46","Value":23},{"DateTime":"2013-10-05T11:43:51","Value":45},{"DateTime":"2013-10-05T11:44:01","Value":49},{"DateTime":"2013-10-05T11:44:11","Value":47},{"DateTime":"2013-10-05T11:44:19","Value":58},{"DateTime":"2013-10-05T11:44:27","Value":47},{"DateTime":"2013-10-05T11:44:35","Value":36},{"DateTime":"2013-10-05T11:44:40","Value":12},{"DateTime":"2013-10-05T11:44:45","Value":24},{"DateTime":"2013-10-05T11:44:50","Value":39},{"DateTime":"2013-10-05T11:45:00","Value":44},{"DateTime":"2013-10-05T11:45:07","Value":33},{"DateTime":"2013-10-05T11:45:14","Value":22},{"DateTime":"2013-10-05T11:45:18","Value":5},{"DateTime":"2013-10-05T11:45:23","Value":31},{"DateTime":"2013-10-05T11:45:30","Value":42},{"DateTime":"2013-10-05T11:45:39","Value":47},{"DateTime":"2013-10-05T11:45:47","Value":36},{"DateTime":"2013-10-05T11:45:52","Value":23},{"DateTime":"2013-10-05T11:45:57","Value":40},{"DateTime":"2013-10-05T11:46:07","Value":42},{"DateTime":"2013-10-05T11:46:14","Value":31},{"DateTime":"2013-10-05T11:46:19","Value":4},{"DateTime":"2013-10-05T11:46:24","Value":18},{"DateTime":"2013-10-05T11:46:29","Value":37},{"DateTime":"2013-10-05T11:46:36","Value":48},{"DateTime":"2013-10-05T11:46:45","Value":48},{"DateTime":"2013-10-05T11:46:50","Value":36},{"DateTime":"2013-10-05T11:47:00","Value":39},{"DateTime":"2013-10-05T11:47:06","Value":28},{"DateTime":"2013-10-05T11:47:10","Value":12},{"DateTime":"2013-10-05T11:47:15","Value":44},{"DateTime":"2013-10-05T11:47:25","Value":48},{"DateTime":"2013-10-05T11:47:35","Value":54},{"DateTime":"2013-10-05T11:47:44","Value":43},{"DateTime":"2013-10-05T11:47:48","Value":27},{"DateTime":"2013-10-05T11:47:53","Value":38},{"DateTime":"2013-10-05T11:48:03","Value":39},{"DateTime":"2013-10-05T11:48:08","Value":23},{"DateTime":"2013-10-05T11:48:14","Value":34},{"DateTime":"2013-10-05T11:48:18","Value":17},{"DateTime":"2013-10-05T11:48:24","Value":6},{"DateTime":"2013-10-05T11:48:28","Value":20},{"DateTime":"2013-10-05T11:48:34","Value":31},{"DateTime":"2013-10-05T11:48:43","Value":38},{"DateTime":"2013-10-05T11:48:49","Value":26},{"DateTime":"2013-10-05T11:48:58","Value":22},{"DateTime":"2013-10-05T11:49:05","Value":11},{"DateTime":"2013-10-05T11:49:10","Value":0},{"DateTime":"2013-10-05T11:49:24","Value":5},{"DateTime":"2013-10-05T11:49:29","Value":0},{"DateTime":"2013-10-05T11:49:42","Value":null}];
			var rpmData=[{"DateTime":"2013-10-05T11:42:32","Value":174.0,"Lat":-33.743919,"Long":151.141174},{"DateTime":"2013-10-05T11:42:41","Value":636.0,"Lat":-33.743916,"Long":151.141178},{"DateTime":"2013-10-05T11:42:51","Value":1013.0,"Lat":-33.743933,"Long":151.141154},{"DateTime":"2013-10-05T11:43:01","Value":1749.0,"Lat":-33.744031,"Long":151.141093},{"DateTime":"2013-10-05T11:43:06","Value":610.0,"Lat":-33.744184,"Long":151.141274},{"DateTime":"2013-10-05T11:43:16","Value":1356.0,"Lat":-33.744396,"Long":151.141811},{"DateTime":"2013-10-05T11:43:26","Value":1483.0,"Lat":-33.744611,"Long":151.142488},{"DateTime":"2013-10-05T11:43:36","Value":1327.0,"Lat":-33.744893,"Long":151.143348},{"DateTime":"2013-10-05T11:43:46","Value":640.0,"Lat":-33.745244,"Long":151.144241},{"DateTime":"2013-10-05T11:43:51","Value":1649.0,"Lat":-33.744896,"Long":151.144423},{"DateTime":"2013-10-05T11:44:01","Value":1329.0,"Lat":-33.743618,"Long":151.144628},{"DateTime":"2013-10-05T11:44:11","Value":1681.0,"Lat":-33.742399,"Long":151.144846},{"DateTime":"2013-10-05T11:44:21","Value":1535.0,"Lat":-33.741084,"Long":151.145101},{"DateTime":"2013-10-05T11:44:31","Value":1647.0,"Lat":-33.739793,"Long":151.145353},{"DateTime":"2013-10-05T11:44:37","Value":642.0,"Lat":-33.739138,"Long":151.145479},{"DateTime":"2013-10-05T11:44:46","Value":1646.0,"Lat":-33.738914,"Long":151.145261},{"DateTime":"2013-10-05T11:44:56","Value":1400.0,"Lat":-33.738066,"Long":151.145154},{"DateTime":"2013-10-05T11:45:06","Value":1276.0,"Lat":-33.737008,"Long":151.145314},{"DateTime":"2013-10-05T11:45:16","Value":603.0,"Lat":-33.736426,"Long":151.144938},{"DateTime":"2013-10-05T11:45:21","Value":1688.0,"Lat":-33.736338,"Long":151.144844},{"DateTime":"2013-10-05T11:45:31","Value":1435.0,"Lat":-33.735574,"Long":151.144301},{"DateTime":"2013-10-05T11:45:41","Value":1532.0,"Lat":-33.734674,"Long":151.143438},{"DateTime":"2013-10-05T11:45:51","Value":1173.0,"Lat":-33.733971,"Long":151.142698},{"DateTime":"2013-10-05T11:46:01","Value":1648.0,"Lat":-33.734026,"Long":151.141734},{"DateTime":"2013-10-05T11:46:11","Value":1334.0,"Lat":-33.733879,"Long":151.140453},{"DateTime":"2013-10-05T11:46:21","Value":627.0,"Lat":-33.733779,"Long":151.139673},{"DateTime":"2013-10-05T11:46:26","Value":1969.0,"Lat":-33.733684,"Long":151.139596},{"DateTime":"2013-10-05T11:46:36","Value":1707.0,"Lat":-33.732742,"Long":151.139691},{"DateTime":"2013-10-05T11:46:46","Value":1245.0,"Lat":-33.731397,"Long":151.139833},{"DateTime":"2013-10-05T11:46:56","Value":1323.0,"Lat":-33.730496,"Long":151.139701},{"DateTime":"2013-10-05T11:47:06","Value":952.0,"Lat":-33.729519,"Long":151.139788},{"DateTime":"2013-10-05T11:47:13","Value":1991.0,"Lat":-33.729217,"Long":151.139721},{"DateTime":"2013-10-05T11:47:22","Value":1368.0,"Lat":-33.728996,"Long":151.138746},{"DateTime":"2013-10-05T11:47:32","Value":1428.0,"Lat":-33.728726,"Long":151.137346},{"DateTime":"2013-10-05T11:47:42","Value":1193.0,"Lat":-33.728557,"Long":151.135781},{"DateTime":"2013-10-05T11:47:52","Value":1538.0,"Lat":-33.728804,"Long":151.134704},{"DateTime":"2013-10-05T11:48:02","Value":1344.0,"Lat":-33.728791,"Long":151.133459},{"DateTime":"2013-10-05T11:48:12","Value":1116.0,"Lat":-33.728656,"Long":151.132536},{"DateTime":"2013-10-05T11:48:22","Value":830.0,"Lat":-33.728561,"Long":151.131842},{"DateTime":"2013-10-05T11:48:32","Value":1624.0,"Lat":-33.728372,"Long":151.131501},{"DateTime":"2013-10-05T11:48:42","Value":1346.0,"Lat":-33.728227,"Long":151.130492},{"DateTime":"2013-10-05T11:48:52","Value":1195.0,"Lat":-33.728102,"Long":151.129529},{"DateTime":"2013-10-05T11:49:02","Value":1550.0,"Lat":-33.727999,"Long":151.128912},{"DateTime":"2013-10-05T11:49:12","Value":623.0,"Lat":-33.727911,"Long":151.128802},{"DateTime":"2013-10-05T11:49:22","Value":625.0,"Lat":-33.727936,"Long":151.128774},{"DateTime":"2013-10-05T11:49:32","Value":633.0,"Lat":-33.727896,"Long":151.128766},{"DateTime":"2013-10-05T11:49:42","Value":0.0,"Lat":-33.727866,"Long":151.128747},{"DateTime":"2013-10-05T11:49:44","Value":null,"Lat":-33.727866,"Long":151.128747}];
			var accelData=[{"DateTime":"2013-10-05T11:42:26","X":0.0888,"Y":0.1482,"Z":0.0359},{"DateTime":"2013-10-05T11:42:28","X":0.0926,"Y":0.1482,"Z":0.0399},{"DateTime":"2013-10-05T11:42:30","X":0.0926,"Y":0.1482,"Z":0.0359},{"DateTime":"2013-10-05T11:42:32","X":0.1003,"Y":0.1482,"Z":0.0319},{"DateTime":"2013-10-05T11:42:34","X":0.0965,"Y":0.1368,"Z":0.0279},{"DateTime":"2013-10-05T11:42:36","X":0.0888,"Y":0.152,"Z":0.0558},{"DateTime":"2013-10-05T11:42:38","X":0.0926,"Y":0.1558,"Z":0.0439},{"DateTime":"2013-10-05T11:42:40","X":0.0926,"Y":0.1406,"Z":0.02},{"DateTime":"2013-10-05T11:42:42","X":0.0965,"Y":0.1558,"Z":0.0439},{"DateTime":"2013-10-05T11:42:44","X":0.0926,"Y":0.1596,"Z":0.0399},{"DateTime":"2013-10-05T11:42:46","X":0.1081,"Y":0.1634,"Z":0.0439},{"DateTime":"2013-10-05T11:42:48","X":0.1235,"Y":0.1711,"Z":0.0279},{"DateTime":"2013-10-05T11:42:50","X":0.1698,"Y":0.1596,"Z":0.0518},{"DateTime":"2013-10-05T11:42:52","X":0.1351,"Y":0.0912,"Z":0.0279},{"DateTime":"2013-10-05T11:42:54","X":0.0386,"Y":-0.0038,"Z":0.0877},{"DateTime":"2013-10-05T11:42:56","X":0.0308,"Y":0.0494,"Z":0.0279},{"DateTime":"2013-10-05T11:42:58","X":0.1389,"Y":0.0532,"Z":0.0399},{"DateTime":"2013-10-05T11:43:00","X":0.22,"Y":-0.0912,"Z":-0.0239},{"DateTime":"2013-10-05T11:43:02","X":0.0849,"Y":-0.0456,"Z":0.0439},{"DateTime":"2013-10-05T11:43:04","X":-0.054,"Y":-0.0152,"Z":-0.1713},{"DateTime":"2013-10-05T11:43:06","X":-0.081,"Y":0.0684,"Z":0.0439},{"DateTime":"2013-10-05T11:43:08","X":0.0193,"Y":0.0646,"Z":0.0558},{"DateTime":"2013-10-05T11:43:10","X":0.0656,"Y":0.0722,"Z":0.0678},{"DateTime":"2013-10-05T11:43:12","X":0.0308,"Y":0.0836,"Z":0.02},{"DateTime":"2013-10-05T11:43:14","X":0.027,"Y":0.0266,"Z":0.02},{"DateTime":"2013-10-05T11:43:16","X":-0.0038,"Y":0.0532,"Z":0.008},{"DateTime":"2013-10-05T11:43:18","X":-0.1235,"Y":0.0494,"Z":0.271},{"DateTime":"2013-10-05T11:43:20","X":-0.1196,"Y":0.0874,"Z":0.024},{"DateTime":"2013-10-05T11:43:22","X":0.0193,"Y":0.0798,"Z":0.0797},{"DateTime":"2013-10-05T11:43:24","X":0.0617,"Y":0.0912,"Z":0.0518},{"DateTime":"2013-10-05T11:43:26","X":0.0308,"Y":0.057,"Z":0.0479},{"DateTime":"2013-10-05T11:43:28","X":-0.0038,"Y":0.0646,"Z":0.0319},{"DateTime":"2013-10-05T11:43:30","X":-0.0077,"Y":0.095,"Z":0.012},{"DateTime":"2013-10-05T11:43:32","X":0.0463,"Y":0.0646,"Z":0.008},{"DateTime":"2013-10-05T11:43:34","X":0.0579,"Y":0.1102,"Z":0.0558},{"DateTime":"2013-10-05T11:43:36","X":0.054,"Y":0.1558,"Z":0.0598},{"DateTime":"2013-10-05T11:43:38","X":0.0656,"Y":0.1444,"Z":0.0439},{"DateTime":"2013-10-05T11:43:40","X":0.0849,"Y":0.0912,"Z":0.024},{"DateTime":"2013-10-05T11:43:42","X":-0.0115,"Y":0.1178,"Z":0.0399},{"DateTime":"2013-10-05T11:43:44","X":-0.0733,"Y":-0.114,"Z":0.0638},{"DateTime":"2013-10-05T11:43:46","X":0.0077,"Y":-0.2167,"Z":0.0837},{"DateTime":"2013-10-05T11:43:48","X":0.0386,"Y":-0.095,"Z":0.0319},{"DateTime":"2013-10-05T11:43:50","X":0.0617,"Y":0.0114,"Z":-0.0039},{"DateTime":"2013-10-05T11:43:52","X":0.0579,"Y":0.0152,"Z":-0.0278},{"DateTime":"2013-10-05T11:43:54","X":0.0772,"Y":0.1368,"Z":-0.0438},{"DateTime":"2013-10-05T11:43:56","X":0.0694,"Y":0.0836,"Z":-0.0358},{"DateTime":"2013-10-05T11:43:58","X":0.1467,"Y":0.0798,"Z":0.0359},{"DateTime":"2013-10-05T11:44:00","X":0.1312,"Y":0.095,"Z":0.0319},{"DateTime":"2013-10-05T11:44:02","X":0.1196,"Y":0.1102,"Z":-0.0039},{"DateTime":"2013-10-05T11:44:04","X":0.193,"Y":0.0722,"Z":0.0837},{"DateTime":"2013-10-05T11:44:06","X":0.1235,"Y":0.0608,"Z":-0.0239},{"DateTime":"2013-10-05T11:44:08","X":0.081,"Y":0.0342,"Z":0.1116},{"DateTime":"2013-10-05T11:44:10","X":0.1003,"Y":0.1026,"Z":0.0598},{"DateTime":"2013-10-05T11:44:12","X":0.1003,"Y":0.0684,"Z":0.1116},{"DateTime":"2013-10-05T11:44:14","X":-0.027,"Y":0.0798,"Z":0.0359},{"DateTime":"2013-10-05T11:44:16","X":0.0115,"Y":0.0494,"Z":0.0479},{"DateTime":"2013-10-05T11:44:18","X":0.027,"Y":0.0152,"Z":0.0877},{"DateTime":"2013-10-05T11:44:20","X":0.0965,"Y":0.0608,"Z":-0.1274},{"DateTime":"2013-10-05T11:44:22","X":0.1081,"Y":0.038,"Z":0.0518},{"DateTime":"2013-10-05T11:44:24","X":0.1081,"Y":0.1444,"Z":0.1156},{"DateTime":"2013-10-05T11:44:26","X":0.1158,"Y":0.038,"Z":0.2152},{"DateTime":"2013-10-05T11:44:28","X":0.22,"Y":0.0646,"Z":0.0638},{"DateTime":"2013-10-05T11:44:30","X":0.1505,"Y":0.095,"Z":0.0638},{"DateTime":"2013-10-05T11:44:32","X":0.1583,"Y":-0.0114,"Z":0.1196},{"DateTime":"2013-10-05T11:44:34","X":0.0077,"Y":0.076,"Z":0.0558},{"DateTime":"2013-10-05T11:44:36","X":-0.1274,"Y":-0.0076,"Z":0.0479},{"DateTime":"2013-10-05T11:44:38","X":-0.1081,"Y":-0.0418,"Z":-0.0119},{"DateTime":"2013-10-05T11:44:40","X":0.0849,"Y":-0.0798,"Z":0.0399},{"DateTime":"2013-10-05T11:44:42","X":0.1274,"Y":-0.0228,"Z":-0.0039},{"DateTime":"2013-10-05T11:44:44","X":0.054,"Y":0.3193,"Z":0.1076},{"DateTime":"2013-10-05T11:44:46","X":0.0888,"Y":0.2813,"Z":0.0279},{"DateTime":"2013-10-05T11:44:48","X":0.0849,"Y":0.1825,"Z":-0.0079},{"DateTime":"2013-10-05T11:44:50","X":0.0154,"Y":0.2395,"Z":0.0598},{"DateTime":"2013-10-05T11:44:52","X":-0.0115,"Y":0.0266,"Z":0.0439},{"DateTime":"2013-10-05T11:44:54","X":-0.0038,"Y":0.0228,"Z":0.0359},{"DateTime":"2013-10-05T11:44:56","X":-0.0077,"Y":0.0342,"Z":0.004},{"DateTime":"2013-10-05T11:44:58","X":-0.0038,"Y":0.057,"Z":-0.0039},{"DateTime":"2013-10-05T11:45:00","X":0.0193,"Y":-0.0456,"Z":-0.0159},{"DateTime":"2013-10-05T11:45:02","X":0.0115,"Y":0.1482,"Z":-0.0796},{"DateTime":"2013-10-05T11:45:04","X":0.0386,"Y":0.0532,"Z":0.0439},{"DateTime":"2013-10-05T11:45:06","X":0.0347,"Y":-0.1216,"Z":-0.0079},{"DateTime":"2013-10-05T11:45:08","X":0.1003,"Y":-0.076,"Z":0.016},{"DateTime":"2013-10-05T11:45:10","X":0.0926,"Y":-0.0152,"Z":0.0319},{"DateTime":"2013-10-05T11:45:12","X":0.0656,"Y":0.0304,"Z":0.0439},{"DateTime":"2013-10-05T11:45:14","X":0.0,"Y":0.0798,"Z":0.0439},{"DateTime":"2013-10-05T11:45:16","X":-0.1351,"Y":0.0646,"Z":0.0638},{"DateTime":"2013-10-05T11:45:18","X":0.054,"Y":0.0418,"Z":0.02},{"DateTime":"2013-10-05T11:45:20","X":0.2818,"Y":0.0912,"Z":0.0718},{"DateTime":"2013-10-05T11:45:22","X":0.1389,"Y":0.0152,"Z":0.016},{"DateTime":"2013-10-05T11:45:24","X":0.0424,"Y":0.0228,"Z":0.0598},{"DateTime":"2013-10-05T11:45:26","X":-0.0038,"Y":0.1254,"Z":0.0718},{"DateTime":"2013-10-05T11:45:28","X":-0.0231,"Y":0.2319,"Z":0.0359},{"DateTime":"2013-10-05T11:45:30","X":-0.0077,"Y":0.0304,"Z":0.0598},{"DateTime":"2013-10-05T11:45:32","X":-0.0115,"Y":-0.0114,"Z":0.0917},{"DateTime":"2013-10-05T11:45:34","X":-0.027,"Y":0.0228,"Z":0.0558},{"DateTime":"2013-10-05T11:45:36","X":-0.0501,"Y":0.0532,"Z":0.0359},{"DateTime":"2013-10-05T11:45:38","X":-0.0386,"Y":0.114,"Z":-0.0239},{"DateTime":"2013-10-05T11:45:40","X":-0.0463,"Y":0.095,"Z":0.024},{"DateTime":"2013-10-05T11:45:42","X":-0.0231,"Y":-0.019,"Z":-0.0079},{"DateTime":"2013-10-05T11:45:44","X":-0.0115,"Y":0.0418,"Z":-0.0836},{"DateTime":"2013-10-05T11:45:46","X":0.0501,"Y":0.1216,"Z":0.012},{"DateTime":"2013-10-05T11:45:48","X":0.0077,"Y":0.0152,"Z":0.0479},{"DateTime":"2013-10-05T11:45:50","X":0.0193,"Y":-0.1596,"Z":0.0598},{"DateTime":"2013-10-05T11:45:52","X":0.2007,"Y":-0.0342,"Z":0.0757},{"DateTime":"2013-10-05T11:45:54","X":0.193,"Y":0.0798,"Z":-0.0079},{"DateTime":"2013-10-05T11:45:56","X":0.1698,"Y":0.1368,"Z":0.1196},{"DateTime":"2013-10-05T11:45:58","X":0.1467,"Y":0.1863,"Z":0.0479},{"DateTime":"2013-10-05T11:46:00","X":0.1505,"Y":0.0532,"Z":0.0279},{"DateTime":"2013-10-05T11:46:02","X":0.0424,"Y":0.114,"Z":0.004},{"DateTime":"2013-10-05T11:46:04","X":0.0115,"Y":0.0874,"Z":0.0718},{"DateTime":"2013-10-05T11:46:06","X":0.0308,"Y":0.0456,"Z":0.0837},{"DateTime":"2013-10-05T11:46:08","X":0.0038,"Y":0.0798,"Z":0.0279},{"DateTime":"2013-10-05T11:46:10","X":-0.0231,"Y":0.0684,"Z":0.0518},{"DateTime":"2013-10-05T11:46:12","X":-0.027,"Y":0.0608,"Z":0.0678},{"DateTime":"2013-10-05T11:46:14","X":-0.1891,"Y":0.0266,"Z":0.0319},{"DateTime":"2013-10-05T11:46:16","X":-0.1235,"Y":0.0836,"Z":0.0558},{"DateTime":"2013-10-05T11:46:18","X":-0.1196,"Y":0.0836,"Z":0.02},{"DateTime":"2013-10-05T11:46:20","X":0.0733,"Y":0.0684,"Z":0.0399},{"DateTime":"2013-10-05T11:46:22","X":0.2007,"Y":0.114,"Z":0.0359},{"DateTime":"2013-10-05T11:46:24","X":0.2393,"Y":0.1825,"Z":0.0359},{"DateTime":"2013-10-05T11:46:26","X":0.2432,"Y":0.114,"Z":0.0359},{"DateTime":"2013-10-05T11:46:28","X":0.1891,"Y":0.076,"Z":-0.0318},{"DateTime":"2013-10-05T11:46:30","X":0.1312,"Y":0.0646,"Z":0.0319},{"DateTime":"2013-10-05T11:46:32","X":0.1389,"Y":0.0152,"Z":0.0757},{"DateTime":"2013-10-05T11:46:34","X":0.2123,"Y":0.1026,"Z":0.0399},{"DateTime":"2013-10-05T11:46:36","X":0.2625,"Y":0.0646,"Z":0.008},{"DateTime":"2013-10-05T11:46:38","X":0.2393,"Y":0.0456,"Z":0.0837},{"DateTime":"2013-10-05T11:46:40","X":-0.0038,"Y":0.0988,"Z":0.0439},{"DateTime":"2013-10-05T11:46:42","X":0.0656,"Y":0.0684,"Z":-0.0079},{"DateTime":"2013-10-05T11:46:44","X":0.0501,"Y":0.0798,"Z":0.008},{"DateTime":"2013-10-05T11:46:46","X":0.0617,"Y":0.133,"Z":0.0359},{"DateTime":"2013-10-05T11:46:48","X":0.1042,"Y":0.0304,"Z":0.0359},{"DateTime":"2013-10-05T11:46:50","X":0.1428,"Y":-0.1254,"Z":0.0279},{"DateTime":"2013-10-05T11:46:52","X":0.1042,"Y":-0.0798,"Z":-0.0039},{"DateTime":"2013-10-05T11:46:54","X":0.0733,"Y":0.1825,"Z":0.0837},{"DateTime":"2013-10-05T11:46:56","X":0.0772,"Y":0.3346,"Z":0.016},{"DateTime":"2013-10-05T11:46:58","X":0.1119,"Y":0.076,"Z":0.0638},{"DateTime":"2013-10-05T11:47:00","X":0.1042,"Y":-0.019,"Z":0.0757},{"DateTime":"2013-10-05T11:47:02","X":0.054,"Y":0.0342,"Z":0.0479},{"DateTime":"2013-10-05T11:47:04","X":-0.0849,"Y":0.0228,"Z":0.0558},{"DateTime":"2013-10-05T11:47:06","X":-0.1853,"Y":-0.0266,"Z":0.1514},{"DateTime":"2013-10-05T11:47:08","X":-0.2702,"Y":-0.0836,"Z":0.0518},{"DateTime":"2013-10-05T11:47:10","X":0.1042,"Y":-0.133,"Z":0.0399},{"DateTime":"2013-10-05T11:47:12","X":0.2857,"Y":-0.0494,"Z":0.0359},{"DateTime":"2013-10-05T11:47:14","X":0.2586,"Y":0.1102,"Z":0.016},{"DateTime":"2013-10-05T11:47:16","X":-0.0347,"Y":0.0,"Z":-0.0159},{"DateTime":"2013-10-05T11:47:18","X":0.0077,"Y":0.152,"Z":0.1395},{"DateTime":"2013-10-05T11:47:20","X":0.0193,"Y":0.2053,"Z":-0.0557},{"DateTime":"2013-10-05T11:47:22","X":0.1312,"Y":-0.2053,"Z":-0.0756},{"DateTime":"2013-10-05T11:47:24","X":0.2123,"Y":0.0228,"Z":0.0837},{"DateTime":"2013-10-05T11:47:26","X":0.1081,"Y":0.0722,"Z":0.0479},{"DateTime":"2013-10-05T11:47:28","X":0.0965,"Y":0.1368,"Z":0.0359},{"DateTime":"2013-10-05T11:47:30","X":0.1003,"Y":0.114,"Z":0.1036},{"DateTime":"2013-10-05T11:47:32","X":0.0965,"Y":0.095,"Z":0.0399},{"DateTime":"2013-10-05T11:47:34","X":0.0965,"Y":0.0684,"Z":0.0558},{"DateTime":"2013-10-05T11:47:36","X":0.0347,"Y":0.1102,"Z":0.016},{"DateTime":"2013-10-05T11:47:38","X":0.0463,"Y":0.038,"Z":0.0598},{"DateTime":"2013-10-05T11:47:40","X":0.027,"Y":-0.1787,"Z":0.0797},{"DateTime":"2013-10-05T11:47:42","X":0.0,"Y":0.0038,"Z":0.0399},{"DateTime":"2013-10-05T11:47:44","X":0.0115,"Y":0.095,"Z":0.0797},{"DateTime":"2013-10-05T11:47:46","X":-0.2007,"Y":0.0874,"Z":0.0399},{"DateTime":"2013-10-05T11:47:48","X":0.0193,"Y":0.1292,"Z":-0.1115},{"DateTime":"2013-10-05T11:47:50","X":0.1274,"Y":0.0798,"Z":0.0319},{"DateTime":"2013-10-05T11:47:52","X":0.1196,"Y":0.0722,"Z":0.0479},{"DateTime":"2013-10-05T11:47:54","X":0.0617,"Y":0.2053,"Z":0.0279},{"DateTime":"2013-10-05T11:47:56","X":0.0347,"Y":0.2395,"Z":0.0957},{"DateTime":"2013-10-05T11:47:58","X":-0.0115,"Y":0.1026,"Z":0.0718},{"DateTime":"2013-10-05T11:48:00","X":-0.1698,"Y":0.1178,"Z":0.0439},{"DateTime":"2013-10-05T11:48:02","X":-0.081,"Y":0.019,"Z":-0.0159},{"DateTime":"2013-10-05T11:48:04","X":-0.0965,"Y":0.1216,"Z":0.0439},{"DateTime":"2013-10-05T11:48:06","X":-0.1737,"Y":0.0798,"Z":0.0558},{"DateTime":"2013-10-05T11:48:08","X":-0.1042,"Y":0.0304,"Z":0.0359},{"DateTime":"2013-10-05T11:48:10","X":0.0193,"Y":0.1064,"Z":0.0718},{"DateTime":"2013-10-05T11:48:12","X":0.0424,"Y":0.0722,"Z":-0.0079},{"DateTime":"2013-10-05T11:48:14","X":0.0,"Y":0.0836,"Z":0.0638},{"DateTime":"2013-10-05T11:48:16","X":-0.1274,"Y":0.0798,"Z":0.0279},{"DateTime":"2013-10-05T11:48:18","X":-0.3166,"Y":0.0798,"Z":0.0279},{"DateTime":"2013-10-05T11:48:20","X":-0.1081,"Y":0.0874,"Z":0.0359},{"DateTime":"2013-10-05T11:48:22","X":0.081,"Y":0.0988,"Z":0.0359},{"DateTime":"2013-10-05T11:48:24","X":-0.1467,"Y":0.0798,"Z":0.0359},{"DateTime":"2013-10-05T11:48:26","X":0.1621,"Y":0.1596,"Z":0.0837},{"DateTime":"2013-10-05T11:48:28","X":0.0347,"Y":0.0304,"Z":0.0837},{"DateTime":"2013-10-05T11:48:30","X":0.0154,"Y":-0.0988,"Z":0.0279},{"DateTime":"2013-10-05T11:48:32","X":0.1389,"Y":0.0418,"Z":-0.0039},{"DateTime":"2013-10-05T11:48:34","X":0.1042,"Y":0.0266,"Z":0.024},{"DateTime":"2013-10-05T11:48:36","X":0.1042,"Y":0.0684,"Z":0.0877},{"DateTime":"2013-10-05T11:48:38","X":0.0733,"Y":0.0456,"Z":0.0359},{"DateTime":"2013-10-05T11:48:40","X":0.0926,"Y":0.0456,"Z":0.0877},{"DateTime":"2013-10-05T11:48:42","X":0.054,"Y":0.0,"Z":0.0359},{"DateTime":"2013-10-05T11:48:44","X":0.1081,"Y":-0.057,"Z":0.0319},{"DateTime":"2013-10-05T11:48:46","X":-0.0347,"Y":0.0266,"Z":0.0399},{"DateTime":"2013-10-05T11:48:48","X":-0.0077,"Y":0.0874,"Z":-0.0159},{"DateTime":"2013-10-05T11:48:50","X":0.0038,"Y":0.0494,"Z":-0.0239},{"DateTime":"2013-10-05T11:48:52","X":0.1003,"Y":0.1064,"Z":0.016},{"DateTime":"2013-10-05T11:48:54","X":0.1312,"Y":0.0152,"Z":0.1315},{"DateTime":"2013-10-05T11:48:56","X":0.0926,"Y":0.0266,"Z":0.0479},{"DateTime":"2013-10-05T11:48:58","X":-0.0038,"Y":0.0874,"Z":0.008},{"DateTime":"2013-10-05T11:49:00","X":-0.1081,"Y":0.076,"Z":0.0279},{"DateTime":"2013-10-05T11:49:02","X":0.1814,"Y":0.2737,"Z":0.024},{"DateTime":"2013-10-05T11:49:04","X":-0.0424,"Y":0.3916,"Z":0.012},{"DateTime":"2013-10-05T11:49:06","X":-0.0231,"Y":0.0418,"Z":0.0279},{"DateTime":"2013-10-05T11:49:08","X":-0.0386,"Y":0.0532,"Z":0.024},{"DateTime":"2013-10-05T11:49:10","X":-0.1196,"Y":0.0646,"Z":0.0279},{"DateTime":"2013-10-05T11:49:12","X":-0.0463,"Y":0.0608,"Z":0.0479},{"DateTime":"2013-10-05T11:49:14","X":-0.0501,"Y":0.0646,"Z":0.0518},{"DateTime":"2013-10-05T11:49:16","X":-0.0501,"Y":0.0684,"Z":0.0558},{"DateTime":"2013-10-05T11:49:18","X":-0.0463,"Y":0.0874,"Z":0.0479},{"DateTime":"2013-10-05T11:49:20","X":-0.0501,"Y":0.0532,"Z":0.0479},{"DateTime":"2013-10-05T11:49:22","X":-0.0501,"Y":0.057,"Z":0.0439},{"DateTime":"2013-10-05T11:49:24","X":0.0347,"Y":0.0456,"Z":0.0399},{"DateTime":"2013-10-05T11:49:26","X":0.0424,"Y":0.0684,"Z":0.0319},{"DateTime":"2013-10-05T11:49:28","X":0.0,"Y":0.0266,"Z":0.0279},{"DateTime":"2013-10-05T11:49:30","X":0.0231,"Y":0.0304,"Z":0.0399},{"DateTime":"2013-10-05T11:49:32","X":0.0463,"Y":0.0494,"Z":0.0399},{"DateTime":"2013-10-05T11:49:34","X":0.0501,"Y":0.0418,"Z":0.0319},{"DateTime":"2013-10-05T11:49:36","X":0.0424,"Y":0.0342,"Z":0.0399},{"DateTime":"2013-10-05T11:49:38","X":0.0501,"Y":0.0342,"Z":0.0319},{"DateTime":"2013-10-05T11:49:40","X":0.0424,"Y":0.0342,"Z":0.0279},{"DateTime":"2013-10-05T11:49:42","X":0.0463,"Y":0.0342,"Z":0.0319}];
			var diData=[{"DateTime":"2013-10-05T11:42:50.894","State":true,Channel:1},{"DateTime":"2013-10-05T11:43:57.097","State":false,Channel:1},{"DateTime":"2013-10-05T11:44:59.703","State":true,Channel:1},{"DateTime":"2013-10-05T11:47:10.101","State":false,Channel:1},{"DateTime":"2013-10-05T11:48:24.699","State":true,Channel:1},{"DateTime":"2013-10-05T11:49:29.499","State":false,Channel:1},{"DateTime":"2013-10-05T11:45:50.894","State":true,Channel:2},{"DateTime":"2013-10-05T11:47:57.097","State":false,Channel:2},{"DateTime":"2013-10-05T11:48:59.703","State":true,Channel:2},{"DateTime":"2013-10-05T11:49:10.101","State":false,Channel:2},{"DateTime":"2013-10-05T11:49:24.699","State":true,Channel:2},{"DateTime":"2013-10-05T11:49:59.499","State":false,Channel:2},{"DateTime":"2013-10-05T11:47:57.097","State":false,Channel:3},{"DateTime":"2013-10-05T11:48:59.703","State":true,Channel:3},{"DateTime":"2013-10-05T11:48:59.703","State":true,Channel:4},{"DateTime":"2013-10-05T11:49:10.101","State":false,Channel:4},{"DateTime":"2013-10-05T11:48:59.703","State":true,Channel:5},{"DateTime":"2013-10-05T11:49:10.101","State":false,Channel:5},{"DateTime":"2013-10-05T11:48:24.699","State":true,Channel:6},{"DateTime":"2013-10-05T11:49:29.499","State":false,Channel:6},{"DateTime":"2013-10-05T11:47:57.097","State":false,Channel:7},{"DateTime":"2013-10-05T11:48:59.703","State":true,Channel:7},{"DateTime":"2013-10-05T11:49:10.101","State":false,Channel:7},{"DateTime":"2013-10-05T11:49:24.699","State":true,Channel:7},{"DateTime":"2013-10-05T11:49:59.499","State":false,Channel:7}];
			var rpmData2=[{"DateTime":"2013-10-05T11:42:32","Value":174.0,"Lat":-33.743919,"Long":151.141174},{"DateTime":"2013-10-05T11:42:41","Value":636.0,"Lat":-33.743916,"Long":151.141178},{"DateTime":"2013-10-05T11:42:51","Value":1013.0,"Lat":-33.743933,"Long":151.141154},{"DateTime":"2013-10-05T11:43:01","Value":1749.0,"Lat":-33.744031,"Long":151.141093},{"DateTime":"2013-10-05T11:43:06","Value":610.0,"Lat":-33.744184,"Long":151.141274},{"DateTime":"2013-10-05T11:43:16","Value":1356.0,"Lat":-33.744396,"Long":151.141811},{"DateTime":"2013-10-05T11:43:26","Value":1483.0,"Lat":-33.744611,"Long":151.142488},{"DateTime":"2013-10-05T11:43:36","Value":1327.0,"Lat":-33.744893,"Long":151.143348},{"DateTime":"2013-10-05T11:43:46","Value":640.0,"Lat":-33.745244,"Long":151.144241},{"DateTime":"2013-10-05T11:43:51","Value":1649.0,"Lat":-33.744896,"Long":151.144423},{"DateTime":"2013-10-05T11:44:01","Value":1329.0,"Lat":-33.743618,"Long":151.144628},{"DateTime":"2013-10-05T11:44:11","Value":1681.0,"Lat":-33.742399,"Long":151.144846},{"DateTime":"2013-10-05T11:44:21","Value":1535.0,"Lat":-33.741084,"Long":151.145101},{"DateTime":"2013-10-05T11:44:31","Value":1647.0,"Lat":-33.739793,"Long":151.145353},{"DateTime":"2013-10-05T11:44:37","Value":642.0,"Lat":-33.739138,"Long":151.145479},{"DateTime":"2013-10-05T11:44:46","Value":1646.0,"Lat":-33.738914,"Long":151.145261},{"DateTime":"2013-10-05T11:44:56","Value":1400.0,"Lat":-33.738066,"Long":151.145154},{"DateTime":"2013-10-05T11:45:06","Value":1276.0,"Lat":-33.737008,"Long":151.145314},{"DateTime":"2013-10-05T11:45:16","Value":603.0,"Lat":-33.736426,"Long":151.144938},{"DateTime":"2013-10-05T11:45:21","Value":1688.0,"Lat":-33.736338,"Long":151.144844},{"DateTime":"2013-10-05T11:45:31","Value":1435.0,"Lat":-33.735574,"Long":151.144301},{"DateTime":"2013-10-05T11:45:41","Value":1532.0,"Lat":-33.734674,"Long":151.143438},{"DateTime":"2013-10-05T11:45:51","Value":1173.0,"Lat":-33.733971,"Long":151.142698},{"DateTime":"2013-10-05T11:46:01","Value":1648.0,"Lat":-33.734026,"Long":151.141734},{"DateTime":"2013-10-05T11:46:11","Value":1334.0,"Lat":-33.733879,"Long":151.140453},{"DateTime":"2013-10-05T11:46:21","Value":627.0,"Lat":-33.733779,"Long":151.139673},{"DateTime":"2013-10-05T11:46:26","Value":1969.0,"Lat":-33.733684,"Long":151.139596},{"DateTime":"2013-10-05T11:46:36","Value":1707.0,"Lat":-33.732742,"Long":151.139691},{"DateTime":"2013-10-05T11:46:46","Value":1245.0,"Lat":-33.731397,"Long":151.139833},{"DateTime":"2013-10-05T11:46:56","Value":1323.0,"Lat":-33.730496,"Long":151.139701},{"DateTime":"2013-10-05T11:47:06","Value":952.0,"Lat":-33.729519,"Long":151.139788},{"DateTime":"2013-10-05T11:47:13","Value":1991.0,"Lat":-33.729217,"Long":151.139721},{"DateTime":"2013-10-05T11:47:22","Value":1368.0,"Lat":-33.728996,"Long":151.138746},{"DateTime":"2013-10-05T11:47:32","Value":1428.0,"Lat":-33.728726,"Long":151.137346},{"DateTime":"2013-10-05T11:47:42","Value":1193.0,"Lat":-33.728557,"Long":151.135781},{"DateTime":"2013-10-05T11:47:52","Value":1538.0,"Lat":-33.728804,"Long":151.134704},{"DateTime":"2013-10-05T11:48:02","Value":1344.0,"Lat":-33.728791,"Long":151.133459},{"DateTime":"2013-10-05T11:48:12","Value":1116.0,"Lat":-33.728656,"Long":151.132536},{"DateTime":"2013-10-05T11:48:22","Value":830.0,"Lat":-33.728561,"Long":151.131842},{"DateTime":"2013-10-05T11:48:32","Value":1624.0,"Lat":-33.728372,"Long":151.131501},{"DateTime":"2013-10-05T11:48:42","Value":1346.0,"Lat":-33.728227,"Long":151.130492},{"DateTime":"2013-10-05T11:48:52","Value":1195.0,"Lat":-33.728102,"Long":151.129529},{"DateTime":"2013-10-05T11:49:02","Value":1550.0,"Lat":-33.727999,"Long":151.128912},{"DateTime":"2013-10-05T11:49:12","Value":623.0,"Lat":-33.727911,"Long":151.128802},{"DateTime":"2013-10-05T11:49:22","Value":625.0,"Lat":-33.727936,"Long":151.128774},{"DateTime":"2013-10-05T11:49:32","Value":633.0,"Lat":-33.727896,"Long":151.128766},{"DateTime":"2013-10-05T11:49:42","Value":0.0,"Lat":-33.727866,"Long":151.128747},{"DateTime":"2013-10-05T11:49:44","Value":null,"Lat":-33.727866,"Long":151.128747}];
			var imps1 = [	{"DateTime":"2013-01-01","Value":30980},
							{"DateTime":"2013-01-02","Value":70863},
							{"DateTime":"2013-01-03","Value":97436},
							{"DateTime":"2013-01-04","Value":115213},
							{"DateTime":"2013-01-05","Value":148866},
							{"DateTime":"2013-01-06","Value":171439},
							{"DateTime":"2013-01-07","Value":204882},
							{"DateTime":"2013-01-08","Value":236596},
							{"DateTime":"2013-01-09","Value":271906},
							{"DateTime":"2013-01-10","Value":315765},
							{"DateTime":"2013-01-11","Value":350624},
							{"DateTime":"2013-01-12","Value":388210},
							{"DateTime":"2013-01-13","Value":431927},
							{"DateTime":"2013-01-14","Value":459666},
							{"DateTime":"2013-01-15","Value":501739},
							{"DateTime":"2013-01-16","Value":535185},
							{"DateTime":"2013-01-17","Value":561015},
							{"DateTime":"2013-01-18","Value":594570},
							{"DateTime":"2013-01-19","Value":619622},
							{"DateTime":"2013-01-20","Value":651657},
							{"DateTime":"2013-01-21","Value":678780},
							{"DateTime":"2013-01-22","Value":704631},
							{"DateTime":"2013-01-23","Value":749684},
							{"DateTime":"2013-01-24","Value":788028},
							{"DateTime":"2013-01-25","Value":814410},
							{"DateTime":"2013-01-26","Value":840612},
							{"DateTime":"2013-01-27","Value":858887},
							{"DateTime":"2013-01-28","Value":889212},
							{"DateTime":"2013-01-29","Value":910631},
							{"DateTime":"2013-01-30","Value":934544},
							{"DateTime":"2013-01-31","Value":975083}];
			
			var imps2 = 	[{"DateTime":"2013-01-01","Value":30980},
							{"DateTime":"2013-01-02","Value":70863},
							{"DateTime":"2013-01-03","Value":97436},
							{"DateTime":"2013-01-04","Value":115213},
							{"DateTime":"2013-01-05","Value":148866},
							{"DateTime":"2013-01-06","Value":171439},
							{"DateTime":"2013-01-07","Value":204882},
							{"DateTime":"2013-01-08","Value":236596},
							{"DateTime":"2013-01-09","Value":271906},
							{"DateTime":"2013-01-10","Value":315765},
							{"DateTime":"2013-01-11","Value":350624},
							{"DateTime":"2013-01-12","Value":388210},
							{"DateTime":"2013-01-13","Value":431927},
							{"DateTime":"2013-01-14","Value":459666},
							{"DateTime":"2013-01-15","Value":501739},
							{"DateTime":"2013-01-16","Value":535185},
							{"DateTime":"2013-01-17","Value":561015},
							{"DateTime":"2013-01-18","Value":594570},
							{"DateTime":"2013-01-19","Value":619622},
							{"DateTime":"2013-01-20","Value":651657},
							{"DateTime":"2013-01-21","Value":678780},
							{"DateTime":"2013-01-22","Value":704631},
							{"DateTime":"2013-01-23","Value":749684},
							{"DateTime":"2013-01-24","Value":788028},
							{"DateTime":"2013-01-25","Value":814410},
							{"DateTime":"2013-01-26","Value":840612},
							{"DateTime":"2013-01-27","Value":858887},
							{"DateTime":"2013-01-28","Value":889212},
							{"DateTime":"2013-01-29","Value":910631},
							{"DateTime":"2013-01-30","Value":934544},
							{"DateTime":"2013-01-31","Value":975083}];
			
			var CTR = 		[{"DateTime":"2013-01-01","Value":0.01},
							{"DateTime":"2013-01-02","Value":0.02},
							{"DateTime":"2013-01-03","Value":0.01},
							{"DateTime":"2013-01-04","Value":0.005},
							{"DateTime":"2013-01-05","Value":0.015},
							{"DateTime":"2013-01-06","Value":0.01},
							{"DateTime":"2013-01-07","Value":0.02},
							{"DateTime":"2013-01-08","Value":0.01},
							{"DateTime":"2013-01-09","Value":0.005},
							{"DateTime":"2013-01-10","Value":0.015},
							{"DateTime":"2013-01-11","Value":0.01},
							{"DateTime":"2013-01-12","Value":0.02},
							{"DateTime":"2013-01-13","Value":0.01},
							{"DateTime":"2013-01-14","Value":0.005},
							{"DateTime":"2013-01-15","Value":0.015},
							{"DateTime":"2013-01-16","Value":0.01},
							{"DateTime":"2013-01-17","Value":0.02},
							{"DateTime":"2013-01-18","Value":0.01},
							{"DateTime":"2013-01-19","Value":0.005},
							{"DateTime":"2013-01-20","Value":0.015},
							{"DateTime":"2013-01-21","Value":0.01},
							{"DateTime":"2013-01-22","Value":0.02},
							{"DateTime":"2013-01-23","Value":0.01},
							{"DateTime":"2013-01-24","Value":0.005},
							{"DateTime":"2013-01-25","Value":0.015},
							{"DateTime":"2013-01-26","Value":0.01},
							{"DateTime":"2013-01-27","Value":0.02},
							{"DateTime":"2013-01-28","Value":0.01},
							{"DateTime":"2013-01-29","Value":0.005},
							{"DateTime":"2013-01-30","Value":0.015},
							{"DateTime":"2013-01-31","Value":0.02}];	
									
			d3Chart.init({ container: '#container', xDim: 'DateTime', callback:updateLocation});
			//d3Chart.addGraph({ id: 'Imps', type: 'analog', name: 'RPM', dataId: 513, yVal: ['Value'], data: imps1 });
		    //d3Chart.addGraph({ id: 'Clicks', type: 'analog', name: 'RPM2', dataId: 513, yVal: ['Value'], data: imps2 });
			//d3Chart.addGraph({ id: 'CTR', type: 'analog', name: 'CTR', dataId: 513, yVal: ['Value'], data: CTR });
		           
		         
			d3Chart.addGraph({ id: 'Speed', type: 'analog', name: 'Speed', dataId: 512, yVal: ['Value'], data: speedData });
		    d3Chart.addGraph({ id: 'Accel', type: 'analog', name: 'Accel', dataId: 522, yVal: ['X', 'Y', 'Z'], data: accelData });
			d3Chart.addGraph({ id: 'RPM', type: 'analog', name: 'RPM', dataId: 522, yVal: ['Value'], data: rpmData });
			      
				
		    d3Chart.render();     
			
			//loop()
		},
		
		updateLocation = function(x){
			//find the closest lng/lat for this time.
			
			console.log("closest value to " + x + " is ");
			pos = [minDistanceDate(x)];
		
			//pos = [locdata[locindex++ % locdata.length]];
        	locationLayer.update(pos);   
            map.panTo(new google.maps.LatLng(pos[0].Lat, pos[0].Long));	
		},
		
		
		minDistanceDate = function(dt) {
    	
        	var result = null, distance = Infinity, dtVal=moment(dt).valueOf();
        	_.each(locdata, function(d) {
            	var m = moment(d.DateTime).valueOf();
           		if (distance > Math.abs(m - dtVal)) {
                	distance = Math.abs(m - dtVal);
                	result = d;
            	}                
        	});
        	return result;
    	}
				
		loop = function(){
               /*var randTimeout = Math.round(Math.random() * (3000 - 500)) + 500;
               setTimeout(function () {
               	   pos = [locdata[locindex++ % locdata.length]]
                   locationLayer.update(pos);   
                   map.panTo(new google.maps.LatLng(pos[0].Lat, pos[0].Long));
                   loop();
               }, randTimeout);*/
        },           

		loadMap = function(mapcenter){ 
		   map = new google.maps.Map(d3.select("#map").node(), {
               zoom: 15,
               center: mapcenter,
               mapTypeId: google.maps.MapTypeId.ROADMAP
           });
            
            GPSUser.prototype = new google.maps.OverlayView(),
            locationLayer = new GPSUser(locdata);
           	
           	locationLayer.setMap(map);
        }
		
	return{
		init: init,
		loadMap:loadMap
	}

});